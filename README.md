# A Digital Oscilloscope Based On ATmega328

There will be a time in an electrical engineer's life when he decides to build his own instruments. Many attempts have been made to build a simple oscilloscope around an Arduino. My project is built upon these similar projects.

## Hardware
ATmega328 chip has a rather powerful analog to digital converter. For this project, I picked Arduino Nano as the main part of the system.
### ADC
It's a 10 bit resolution successive approximation ADC. Input voltage range is 0 - Vcc. In this project, I attempt to run this ADC at its maximum speed. In order to achieve that, there are a few steps to go through. First, ADC is put in free running mode. In this mode, a new conversion starts immediately after the conversion completes. One conversion takes 13 ADC clock cycles.

The 10 bit result generated by ADC is presented ADC Data Register, ADCH and ADCL. Both ADCH and ADCL are 8 bit wide. If less precison is needed, only ADCH is read. An interrupt is triggered when a conversion completes.

### Front-end
The front end is designed around a LM324 op-amp. Power is supplied by a 9V adapter. It powers the Arduino Nano and LM324.
### Acquisition
After the voltage of a signal is measured by ADC, this 8 bit integer is stored in a 1000 byte circular buffer. When the oscilloscope is triggered, ADC will sample another 500 bytes, thus the circular buffer will contain information before and after the trigger event.

### Didplay
ATmega328 simply doesn't have the processing power or memeory to acquire and display a signal. So information stored in the circular buffer is transmitted to a PC for display.

## Software

### Arduino
Software running on Arduino is written using a few functions from Arduino platform, but the code is mostly in accordance with C++ standards. The main function of the code is acquisition and transmission of information to pc.

### User Interface
Software running on PC is written is Python. UI features are built with Tkinter and Pygame libararies for Python. Tinkter offers many UI features commonly found in Windows interfaces. Pygame is quite robust in animating data on 2D surfaces. Data transmission from MCU is handled by Pyserial.

### Communication Protocol
I chose UART as the communication protocol between the microcontroller and pc since Arduino Nano already has UART-USB bridge.

## PCB

PCB and schematic are designed with KiCad. It's 2 layer design. The back side is mostly ground plane. Other than Arduino Nano and LM324, most components on this PCB are surfaced mounted.

<p align="center">
  <img src="https://github.com/yff-001/atmega328-digital-oscilloscope/blob/master/images/pcb_top.png" width="1000" title="PCB Top">
</p>

<p align="center">
  <img src="https://github.com/yff-001/atmega328-digital-oscilloscope/blob/master/images/pcb_bottom.png" width="1000" title="PCB Bottom">
</p>

PCB were ordered from a popular manufacturer in China. 

<p align="center">
  <img src="https://github.com/yff-001/atmega328-digital-oscilloscope/blob/master/images/IMG_1096.jpg" width="1000" title="PCB Bottom">
</p>